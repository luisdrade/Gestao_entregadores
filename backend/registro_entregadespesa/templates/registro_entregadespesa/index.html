<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <title>Registro de Entregas e Despesas</title>
    <style>
        /* Esconder elementos com a classe hidden */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
        <nav style="background-color: #f0f0f0; padding: 15px; margin-bottom: 30px;">
    <a href="{% url 'relatorios_dashboard:dashboard' %}" style="margin-right: 20px;">🏠 Dashboard</a>
    <a href="/cadastro-veiculo/" style="margin-right: 20px;">🚗 Cadastro de Veículo</a>
    <a href="/registro/" style="margin-right: 20px;">📦 Registro de Entregas</a>
    <a href="/relatorios/" style="margin-right: 20px;">📊 Relatórios</a>
    <a href="/comunidade/" style="margin-right: 20px;">🧑‍🤝‍🧑 Comunidade</a>
</nav>

    <h1>Registro de Entregas e Despesas</h1>

    <form method="post" id="registroForm">
        {% csrf_token %}

        <!-- Escolha do tipo de rendimento -->
        <p>
            {{ form.tipo_rendimento.label_tag }}<br />
            {{ form.tipo_rendimento }}
        </p>

        <!-- Campos para valor unitário -->
        <div id="valorUnitarioFields" class="hidden">
            <p>
                {{ form.valor_unitario.label_tag }}<br />
                {{ form.valor_unitario }}
            </p>
        </div>

        <!-- Campos para valor diária -->
        <div id="valorDiariaFields" class="hidden">
            <p>
                {{ form.valor_diaria.label_tag }}<br />
                {{ form.valor_diaria }}
            </p>
        </div>

        <!-- Campos sempre visíveis -->
        <p>
            {{ form.total_pacotes.label_tag }}<br />
            {{ form.total_pacotes }}
        </p>
        <p>
            {{ form.pacotes_entregues.label_tag }}<br />
            {{ form.pacotes_entregues }}
        </p>
        <p>
            {{ form.pacotes_nao_entregues.label_tag }}<br />
            {{ form.pacotes_nao_entregues }}
        </p>

        <!-- Categoria de despesa -->
        <p>
            {{ form.categoria_despesa.label_tag }}<br />
            {{ form.categoria_despesa }}
        </p>

        <!-- Descrição para "Outros" -->
        <p id="descricaoOutrosDiv" class="hidden">
            {{ form.descricao_outros.label_tag }}<br />
            {{ form.descricao_outros }}
        </p>

        <p>
            {{ form.valor_despesa.label_tag }}<br />
            {{ form.valor_despesa }}
        </p>

        <button type="submit">Salvar Registro</button>
    </form>

    {% if resultado %}
        <hr />
        <h2>Resumo do Dia</h2>
        <p><strong>Pacotes Entregues:</strong> {{ resultado.entregues }}</p>
        <p><strong>Pacotes Não Entregues:</strong> {{ resultado.nao_entregues }}</p>
        <p><strong>Ganho:</strong> R$ {{ resultado.ganho }}</p>
        <p><strong>Despesa:</strong> R$ {{ resultado.despesa }}</p>
        <p><strong>Lucro:</strong> R$ {{ resultado.lucro }}</p>
    {% endif %}

    <script>
        const tipoRendimentoSelect = document.getElementById('id_tipo_rendimento');
        const valorUnitarioFields = document.getElementById('valorUnitarioFields');
        const valorDiariaFields = document.getElementById('valorDiariaFields');
        const categoriaDespesaSelect = document.getElementById('id_categoria_despesa');
        const descricaoOutrosDiv = document.getElementById('descricaoOutrosDiv');

        function atualizarCampos() {
            const tipo = tipoRendimentoSelect.value;
            if (tipo === 'unitario') {
                valorUnitarioFields.classList.remove('hidden');
                valorDiariaFields.classList.add('hidden');
            } else if (tipo === 'diaria') {
                valorDiariaFields.classList.remove('hidden');
                valorUnitarioFields.classList.add('hidden');
            } else {
                valorUnitarioFields.classList.add('hidden');
                valorDiariaFields.classList.add('hidden');
            }
        }

        function atualizarDescricaoOutros() {
            if (categoriaDespesaSelect.value === 'outros') {
                descricaoOutrosDiv.classList.remove('hidden');
            } else {
                descricaoOutrosDiv.classList.add('hidden');
            }
        }

        tipoRendimentoSelect.addEventListener('change', atualizarCampos);
        categoriaDespesaSelect.addEventListener('change', atualizarDescricaoOutros);

        document.addEventListener('DOMContentLoaded', () => {
            atualizarCampos();
            atualizarDescricaoOutros();
        });
    </script>
</body>
</html>
